<!DOCTYPE html>
<html>

<head>
    <title>Habits tracker</title>
    <style>
        textarea {
            width: 400px;
            height: 200px;
        }
    </style>
</head>

<body>
    <h1>Habits tracker</h1>

    <div id="example-logs">
	<pre>
	The keys are of two types : boolean (def with a comma) and by value (def with a colon).
	If boolean, it just counts the number of their apparition (after the comma you can add a comment). If by value, it takes the value after the colon.
	A log starting with a colon is a comment.
	</pre>
        <p>Example Logs:</p>
        <pre>
Keys:
S, Sport
N: Nuit
A, Alcool
R, Restaurant
:EndKeys

20230423
S
V
S
R
N: 2
Mood, Good
: A very productive day
S, Went for a run in the park
#ðŸ˜€
        </pre>
    </div>
    <form id="check-form">
        <label for="keys-input">Keys to analyze (separated by a comma). If nothing, it considers all keys:</label><br>
        <textarea id="keys-input" rows="4" cols="50"></textarea><br>
        <label for="text-input">Logs:</label><br>
        <textarea id="text-input" rows="8" cols="50"></textarea>
        <button type="submit">Check</button>
    </form>



    <p id="result"></p>

    <script>
     document.getElementById('check-form').addEventListener('submit', function (event) {
         event.preventDefault();

         const keysInput = document.getElementById('keys-input');
         const textInput = document.getElementById('text-input');

         const keys = keysInput.value;
         const text = textInput.value;
         if (!text) {
             return;
         }

         fetch('https://test1029.herokuapp.com/check', {
             // fetch('http://192.168.1.28:8000/check', {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json',
             },
             body: JSON.stringify({
                 text: text,
                 keys_to_retrieve: keys,
             }),
         })
             .then(response => response.json())
             .then(data => {
                 // Use innerHTML instead of textContent to insert HTML
                 document.getElementById('result').innerHTML = 'Result: <br>' + data.result;

                 // Create a new image element
                 const img = new Image();

                 // Set the source of the image to the base64 data
                 img.src = 'data:image/png;base64,' + data.image;

                 // Append the image to the body of the document
                 document.body.appendChild(img);

                 // Create a new image element
                 const img_h = new Image();

                 // Set the source of the image to the base64 data
                 img_h.src = 'data:image/png;base64,' + data.image_heatmap;

                 // Append the image to the body of the document
                 document.body.appendChild(img_h);
             })
             .catch(error => {
                 console.error('Error:', error);
             });
     });
    </script>
</body>

</html>
